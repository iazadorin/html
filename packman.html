<!DOCTYPE html>
<html>
<head>
	<title>
		Обнаружение алмаза Монах
	</title>
	<style>
		canvas{
			border: 1px solid black;
		}
	</style>
</head>
<body onload="score()">
	<canvas id ='can' width=400 height=400 style='background-color:black'>
	</canvas>
	<pre id="p" style="font-size:25px"></pre>
	<script>
		var gameOver = false;
		var sco = 0;
		var e = document.getElementById('p');
		var can = document.getElementById('can');
		var c = can.getContext('2d');
		var packMan = {
			n: 0,
			x: 100,
			y: 100,
			vx: 0,
			vy: 0,
			v:4,
			radius: 25,
			color: 'Moccasin',
			draw: function() {
				var a = 30;
				if(this.n<10){
					a=0;
				}
				else if(this.n<20){
					a=15;
				}
				else if(this.n<30){
					a=30;
				}
				else if(this.n<40){
					a=45;
				}
				else if(this.n<50){
					a=60;
				}
				else if(this.n<60){
					a=45;
				}
				else if(this.n<70){
					a=30;
				}
				else{
					a=15;
				}
				c.beginPath();
				c.arc(this.x, this.y, this.radius, Math.PI * a/180, Math.PI * (360-a)/180);
				c.lineTo(this.x, this.y);
				c.closePath();
				c.fillStyle = this.color;
				c.fill();
				c.stroke();
				if(this.vx!=0 || this.vy!=0){
					this.n++;
					if(this.n>=80){
						this.n=0;
					}
				}
			}
		}
		var dot = {
			n:0,
			x:0,
			y:0,
			r:10,
			color:'gold',
			draw: function(){
					var a = 0;
					if(this.n<10){
						a=0;
					}
					else if(this.n<20){
						a=0.5;
					}
					else if(this.n<30){
						a=1;
					}
					else if(this.n<40){
						a=1.5;
					}
					else if(this.n<50){
						a=2;
					}
					else if(this.n<60){
						a=2.5;
					}
					else if(this.n<70){
						a=3;
					}
					else if(this.n<80){
						a=2.5;
					}
					else if(this.n<90){
						a=2;
					}
					else if(this.n<100){
						a=1.5;
					}
					else if(this.n<110){
						a=1;
					}
					else{
						a=0.5;
					}
				c.beginPath();
				c.arc(this.x, this.y, this.r + a, 0, 2*Math.PI);
				c.fillStyle = this.color;
				c.fill();
				c.stroke();
				this.n++;
				if(this.n>=120){
					this.n=0;
				}
			},
			move: function(){
				this.x = Math.floor(this.r + Math.random() * (can.width-2*this.r));
				this.y = Math.floor(this.r + Math.random() * (can.height-2*this.r));
			}
		}
		var monster = {
			x:50,
			y:60,
			r:25,
			v:1,
			n:0,
			color:'red',
			draw: function(){
				var a = 0;
				if(this.n<100){
					a=Math.floor(this.n/10);
				}
				else {
					a= 20 - Math.floor(this.n/10);
				}
				
				c.beginPath();
				c.arc(this.x, this.y, this.r, Math.PI, 0);
				c.lineTo(this.x + this.r, this.y + this.r);
				c.bezierCurveTo(
					this.x - 0.25*this.r, this.y + this.r/2, 
					this.x + 0.25*this.r, this.y + 1.5*this.r, 
					this.x - this.r, this.y + this.r);
				c.closePath();
				c.fillStyle = this.color;
				c.fill();
				c.stroke();
				c.beginPath();
				c.ellipse(this.x, this.y, 15, a, 0, 0, 2*Math.PI);
				c.fillStyle = 'navy';
				c.fill();
				c.stroke();
				this.n++;
				if(this.n>=200){
					this.n=0;
				}

			},
			move: function(){
				this.x = Math.floor(can.width/2 + Math.random() * can.width/2);
				this.y = Math.floor(can.height/2 + Math.random() * can.height/2);
			}
		}
		function loop() {
			c.clearRect(0,0, can.width, can.height);
			background();
			monster.draw();
			dot.draw();
			packMan.draw();
			if (packMan.y + packMan.vy > can.height || packMan.y + packMan.vy < 0) {
				packMan.vy = -packMan.vy;
			}
			if (packMan.x + packMan.vx > can.width || packMan.x + packMan.vx < 0) {
				packMan.vx = -packMan.vx;
			}
			packMan.x += packMan.vx;
			packMan.y += packMan.vy;
			if (Math.abs(packMan.x - dot.x) < packMan.radius + dot.r && Math.abs(packMan.y - dot.y) < packMan.radius + dot.r){
				dot.move();
				score();
			}
			chase();
			fail();
			window.requestAnimationFrame(loop);
		}
		function fail(){
			if (Math.abs(packMan.x - monster.x) < packMan.radius + monster.r && Math.abs(packMan.y - monster.y) < packMan.radius + monster.r){
				if (gameOver==true){
					return;
				}
				e.textContent += "\n"
				e.textContent += "Вы проиграли!"
				gameOver = true;
				packMan.vx = 0;
				packMan.vy = 0;
			}
		}
		function keyDown(event){
			const keyName = event.key;
			if (gameOver==true){
				return;
			}
			if(keyName==="ArrowUp"){
				packMan.vy=-packMan.v;
				packMan.vx=0;
			}
			if(keyName==="ArrowDown"){
				packMan.vy=packMan.v;
				packMan.vx=0;
			}
			if(keyName==="ArrowRight"){
				packMan.vx=packMan.v;
				packMan.vy=0;
			}
			if(keyName==="ArrowLeft"){
				packMan.vx=-packMan.v;
				packMan.vy=0;
			}
			if(keyName===" "){
				packMan.vx=0;
				packMan.vy=0;
				
			}
		}
		function chase(){
			if(monster.x > packMan.x){
				monster.x -=monster.v
			}
			if(monster.y > packMan.y){
				monster.y -=monster.v
			}
			if(monster.x < packMan.x){
				monster.x +=monster.v
			}
			if(monster.y < packMan.y){
				monster.y +=monster.v
			}
		}
		function score(){
			e.textContent = "Cчёт: " + sco;
			sco++;
			if(sco >= 15){
				monster.v = 1.25;
			}
			if(sco >= 30){
				monster.v = 1.5;
			}
		}
		function background(){
			var step = 20;
			var r = 1.5;
			
			for(var y = step; y < can.height; y += step){
				for(var x = step; x < can.width; x += step){
					c.beginPath();
					c.arc(x, y, r, 0, 2*Math.PI);
					c.closePath();
					c.fillStyle = '#696969';
					c.fill();
					c.stroke();
				}
			}
		}
		document.addEventListener('keydown', keyDown, false);
		dot.move();
		monster.move();	
		loop();
	</script>

</body>
</html>