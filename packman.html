<!DOCTYPE html>
<html>
<head>
	<title>
		Обнаружение алмаза Монах
	</title>
	<style>
		canvas{
			border: 1px solid black;
		}
	</style>
</head>
<body onload="score()">
	<canvas id ='can' width=400 height=400>
	</canvas>
	<pre id="p" style="font-size:25px"></pre>
	<script>
		var sco = 0;
		var e = document.getElementById('p');
		var can = document.getElementById('can');
		var c = can.getContext('2d');
		var packMan = {
			n: 0,
			x: 100,
			y: 100,
			vx: 0,
			vy: 0,
			radius: 25,
			color: 'blue',
			draw: function() {
				var a = 30;
				if(this.n<10){
					a=0;
				}
				else if(this.n<20){
					a=15;
				}
				else if(this.n<30){
					a=30;
				}
				else if(this.n<40){
					a=45;
				}
				else if(this.n<50){
					a=60;
				}
				else if(this.n<60){
					a=45;
				}
				else if(this.n<70){
					a=30;
				}
				else{
					a=15;
				}
				c.beginPath();
				c.arc(this.x, this.y, this.radius, Math.PI * a/180, Math.PI * (360-a)/180);
				c.lineTo(this.x, this.y);
				c.closePath();
				c.fillStyle = this.color;
				c.fill();
				c.stroke();
				if(this.vx!=0 || this.vy!=0){
					this.n++;
					if(this.n>=80){
						this.n=0;
					}
				}
			}
		}
		var dot = {
			x:0,
			y:0,
			r:10,
			color:'red',
			draw: function(){
				c.beginPath();
				c.arc(this.x, this.y, this.r, 0, 2*Math.PI);
				c.fillStyle = this.color;
				c.fill();
				c.stroke();
			},
			move: function(){
				this.x = Math.floor(this.r + Math.random() * (can.width-2*this.r));
				this.y = Math.floor(this.r + Math.random() * (can.height-2*this.r));
			}
		}
		function draw() {
			c.clearRect(0,0, can.width, can.height);
			dot.draw();
			packMan.draw();
			if (packMan.y + packMan.vy > can.height || packMan.y + packMan.vy < 0) {
				packMan.vy = -packMan.vy;
			}
			if (packMan.x + packMan.vx > can.width || packMan.x + packMan.vx < 0) {
				packMan.vx = -packMan.vx;
			}
			packMan.x += packMan.vx;
			packMan.y += packMan.vy;
			if (Math.abs(packMan.x - dot.x) < packMan.radius + dot.r && Math.abs(packMan.y - dot.y) < packMan.radius + dot.r){
				dot.move();
				score();
			}
			window.requestAnimationFrame(draw);
		}
		function keyDown(event){
			const keyName = event.key;
			if(keyName==="ArrowUp"){
				packMan.vy=-2;
				packMan.vx=0;
			}
			if(keyName==="ArrowDown"){
				packMan.vy=2;
				packMan.vx=0;
			}
			if(keyName==="ArrowRight"){
				packMan.vx=2;
				packMan.vy=0;
			}
			if(keyName==="ArrowLeft"){
				packMan.vx=-2;
				packMan.vy=0;
			}
			if(keyName===" "){
				packMan.vx=0;
				packMan.vy=0;
				
			}
		}
		function score(){
			e.textContent = "Cчёт: " + sco;
			sco++;
		}
		document.addEventListener('keydown', keyDown, false);
		dot.move();
		draw()
	</script>

</body>
</html>